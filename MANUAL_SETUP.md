# 手動配對設定功能說明 (Manual Match Setup Guide)

## 功能概述

除了原有的自動生成賽程功能外，系統現在提供**手動配對設定**功能，讓賽事管理員可以完全控制每一輪、每一點的選手配對。

## 使用方式

### 1. 準備工作
- 確保已新增40名正式選手（每隊10人）
- 可以另外加入候補選手（不計入10人名額）

### 2. 啟動手動配對模式
1. 在「賽事設定」頁面中
2. 點擊 **「手動配對設定」** 按鈕（而非「自動生成賽程」）
3. 系統會進入手動配對介面

### 3. 配對流程

#### 輪次導航
- 系統會顯示3個輪次標籤
- 點擊標籤切換到不同輪次進行設定
- 每輪包含6個對戰組合（甲乙、甲丙、甲丁、乙丙、乙丁、丙丁）

#### 對戰配對
每個對戰組合需要設定5點雙打：

**第1-4點：** 年齡遞增規則
- 選擇2名選手組成雙打
- 確保總年齡逐點遞增
- 系統會顯示配對的總年齡

**第5點：** 混雙或女雙
- 必須安排混雙（一男一女）或女雙（兩名女性）
- 系統會顯示提示標籤

#### 選手選擇
- 每個配對需要從下拉選單選擇2名選手
- 下拉選單只顯示該隊伍的正式選手
- 選單中顯示選手姓名、年齡、性別

### 4. 驗證與檢查

系統會自動驗證以下規則：

✅ **完整性檢查**
- 所有配對都已填寫完成
- 每個位置都有選手

✅ **年齡遞增檢查（第1-4點）**
- 第1點 < 第2點 < 第3點 < 第4點（總年齡）
- 每隊獨立檢查

✅ **混雙/女雙檢查（第5點）**
- 確保第5點符合混雙或女雙規則
- 不符合規則會顯示錯誤訊息

### 5. 完成設定

1. **切換輪次**：配對完一輪後，點擊「下一輪 →」繼續
2. **最後一輪**：第3輪完成後，按鈕會變成「完成配對並開始賽事」
3. **開始賽事**：驗證通過後，系統會生成所有比賽並進入比賽記錄頁面

## 優點與適用場景

### 自動生成賽程 vs 手動配對設定

| 功能 | 自動生成賽程 | 手動配對設定 |
|------|------------|------------|
| 速度 | ⚡ 快速（一鍵生成） | 🐢 需要逐一設定 |
| 控制 | ❌ 無法控制配對 | ✅ 完全控制配對 |
| 策略 | ❌ 隨機配對 | ✅ 可策略性安排 |
| 適合 | 快速測試、練習賽 | 正式比賽、特定策略 |

### 適用場景

**建議使用手動配對設定：**
- 正式比賽需要策略性安排選手
- 考慮選手體力、狀態進行輪換
- 需要避免某些選手組合
- 想要平衡各選手的出賽機會

**建議使用自動生成：**
- 快速開始測試
- 練習賽或友誼賽
- 不在意具體配對組合

## 使用技巧

### 1. 先規劃後設定
建議先在紙上或Excel規劃好配對，再進入系統設定

### 2. 注意年齡組合
- 先確認隊伍中選手的年齡分布
- 規劃好第1-4點的年齡梯度
- 留意最年輕和最年長的配對

### 3. 第5點配對
- 優先考慮混雙（可以讓更多選手參賽）
- 女雙作為備選方案
- 確保符合規則要求

### 4. 平衡出賽機會
- 系統要求每位正式選手至少出賽2場
- 手動配對時需自行注意各選手的出賽次數
- 建議記錄每位選手已安排的比賽數

### 5. 儲存與檢查
- 每輪設定完成後先點擊「下一輪」進行驗證
- 如有錯誤，系統會顯示詳細的錯誤訊息
- 可以隨時返回修改

## 常見錯誤處理

### 錯誤訊息：「XX對戰 第X點 XX隊未配對完成」
**原因**：該配對還有空位
**解決**：為該配對的兩個位置都選擇選手

### 錯誤訊息：「XX對戰 第5點 XX隊必須為混雙或女雙」
**原因**：第5點安排了兩名男性選手
**解決**：改為混雙（一男一女）或女雙（兩名女性）

### 錯誤訊息：「XX對戰 XX隊 第X點年齡未遞增」
**原因**：該點的總年齡沒有比前一點大
**解決**：調整配對，確保總年齡遞增

## 介面說明

### 頂部導航
- 顯示目前設定的輪次
- 輪次標籤可點擊切換

### 對戰區塊
- 每個對戰組合獨立顯示
- 顯示隊伍名稱和對戰標題

### 配對卡片
- 每點雙打一張卡片
- 左右兩側分別是兩隊的選手選擇
- 中間顯示 "VS"
- 第5點會顯示「混雙或女雙」提示

### 底部按鈕
- **返回**：回到賽事設定頁面（未儲存的設定會遺失）
- **下一輪 →**：驗證目前輪次並切換到下一輪
- **完成配對並開始賽事**：最後一輪完成後的按鈕

## 資料儲存

- 手動配對的資料會在完成後轉換為正式比賽資料
- 儲存在 localStorage 中
- 與自動生成的賽程資料格式相同
- 後續的比賽記錄、計分、排名功能完全一致

## 技術細節

### 資料結構
```typescript
interface MatchAssignment {
  id: string;                    // 比賽唯一識別碼
  roundNumber: number;            // 輪次編號 (1-3)
  pointNumber: PointType;         // 點數編號 (1-5)
  team1: TeamName;                // 隊伍1
  team2: TeamName;                // 隊伍2
  pair1: [Player | null, Player | null];  // 隊伍1的配對
  pair2: [Player | null, Player | null];  // 隊伍2的配對
}
```

### 對戰組合
總共6種對戰組合：
1. 甲隊 vs 乙隊
2. 甲隊 vs 丙隊
3. 甲隊 vs 丁隊
4. 乙隊 vs 丙隊
5. 乙隊 vs 丁隊
6. 丙隊 vs 丁隊

### 總比賽數
- 3輪 × 6對戰 × 5點 = **90場比賽**

## 未來擴充

已實現功能：
- ✅ 儲存配對範本供下次使用
- ✅ 匯出/匯入配對設定

可能的功能擴充：
- 顯示每位選手的已配對次數統計
- 複製上一輪的配對作為基礎
- 智能提示建議配對

## 範本管理功能

### 儲存範本
1. 在手動配對頁面點擊「💾 儲存範本」
2. 輸入範本名稱（例如：標準配對、女雙優先）
3. 點擊「確定儲存」
4. 範本會自動儲存到瀏覽器本地儲存

### 載入範本
1. 點擊「📂 載入範本」
2. 查看已儲存的範本列表
3. 每個範本顯示：
   - 範本名稱
   - 儲存日期時間
   - 賽事設定（人數/點數/輪數）
4. 點擊「載入」按鈕使用該範本
5. 系統會自動匹配選手ID，若找不到會顯示空白

**注意事項：**
- 範本會檢查設定是否相符（人數/點數/輪數）
- 如果設定不同會顯示警告訊息
- 載入範本會覆蓋目前的配對設定

### 刪除範本
1. 在載入範本對話框中
2. 點擊範本右側的「刪除」按鈕
3. 確認後即可刪除

### 匯出設定
1. 點擊「📤 匯出設定」
2. 系統會下載 JSON 檔案
3. 檔名格式：`配對設定_YYYY-MM-DD.json`
4. 檔案包含完整的配對資訊和選手資料
5. 可用於備份或分享配對設定

### 匯入設定
1. 點擊「📥 匯入設定」
2. 選擇先前匯出的 JSON 檔案
3. 系統會自動匹配選手（根據ID或姓名）
4. 匯入成功後顯示確認訊息

**匯入注意事項：**
- 匯入會覆蓋目前的配對設定
- 系統會嘗試根據選手ID或姓名匹配
- 若找不到對應選手，該位置會顯示為空白
- 建議在相同選手陣容下使用匯入功能

## 使用場景範例

### 場景1：固定配對模式
有些賽事每年的配對模式類似，可以：
1. 第一年手動設定好配對
2. 儲存為範本「2025標準配對」
3. 明年新增選手後，載入範本
4. 系統自動填入配對，只需微調

### 場景2：多個賽事共用
同時舉辦多個賽事時：
1. 設定好第一個賽事的配對
2. 匯出為 JSON 檔案
3. 在其他賽事中匯入
4. 減少重複設定時間

### 場景3：備份與恢復
避免誤操作導致配對遺失：
1. 完成配對後立即匯出備份
2. 如果不小心修改錯誤
3. 可以重新匯入先前的備份
4. 恢復正確的配對狀態

---

如有任何問題或建議，請隨時回報！
